globalThis.openNextDebug = false;globalThis.openNextVersion = "2.3.8";
import p from"node:fs";import N from"node:https";import u from"node:path";function s(...e){globalThis.openNextDebug&&console.log(...e)}function d(...e){console.warn(...e)}var f=[{clientName:"S3Client",commandName:"GetObjectCommand",errorName:"NoSuchKey"}],l=e=>f.some(r=>r.clientName===e?.clientName&&r.commandName===e?.commandName&&(r.errorName===e?.error?.name||r.errorName===e?.error?.Code));function i(...e){if(e.some(r=>l(r))){d(...e);return}console.error(...e)}var h=g(),w=async e=>{for(let r of e.Records){let{host:o,url:n}=JSON.parse(r.body);s("Revalidating stale page",{host:o,url:n}),await new Promise((m,c)=>{let a=N.request(`https://${o}${n}`,{method:"HEAD",headers:{"x-prerender-revalidate":h.preview.previewModeId,"x-isr":"1"}},t=>m(t));a.on("error",t=>{i("Error revalidating page",{host:o,url:n}),c(t)}),a.end()})}};function g(){let e=u.join("prerender-manifest.json"),r=p.readFileSync(e,"utf-8");return JSON.parse(r)}export{w as handler};
